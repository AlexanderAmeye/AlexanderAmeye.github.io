<!DOCTYPE html>
<html lang="en">

<head>
  <!-- SITE INFO -->
  <title>Outline Shader</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="favicon.ico?">

  <!-- ANALYTICS -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-137365487-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-137365487-1');
  </script>

  <!-- FONTS -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link href="css/style.css" rel="stylesheet">
  <link rel="stylesheet" href="css/bootstrap/bootstrap.css">
</head>

<body>
  <div class="container">
    <br><br>

    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="index.html" id="link">Home</a>
      </li>

      <li class="breadcrumb-item">Outline Shader</li>
    </ol>

    <span class="badge badge-dark">Unity 2019.3.0f1</span>
    <span class="badge badge-dark">URP 7.1.6</span>
    <span class="badge badge-warning">Intermediate</span>
    <span class="badge badge-primary">January 7th 2020</span>
    <br><br>

    <!--IMAGE-->
    <br>
    <div class="text-center">
      <figure class="figure ">
        <img src="img/shaders/outline/FinalEffect.png" width="800" class="figure-img" alt="">
        <figcaption class="figure-caption">The final result</figcaption>
      </figure>
    </div>
    <br>

    <!--INTRODUCTION-->
    <h2 class="mt-4 mb-3">Introduction</h2>
    <p>Imagine we give our shader the image below on the left and we want the shader to generate an outline for us. We
      could
      simply detect if there is a sudden color discontinuity, and if that is the case, draw an outline. However, it is
      possible that not all sides have a different color like in the second image. In that case we will need to take a
      look at the orientation of the face (the normal vector). In the last image, the background has the same color as
      some of the sides of the structure, in this case we will need to take a look at a depth difference in the scene.
    </p>

    <br><br>
    <div class="text-center">
      <figure class="figure ">
        <img src="img/shaders/outline/discontinuities_color.png" width="300" class="figure-img" alt="">
        <figcaption class="figure-caption"></figcaption>
      </figure>
      <figure class="figure ">
        <img src="img/shaders/outline/discontinuities_normals.png" width="300" class="figure-img" alt="">
        <figcaption class="figure-caption"></figcaption>
      </figure>
      <figure class="figure ">
        <img src="img/shaders/outline/discontinuities_depth.png" width="300" class="figure-img" alt="">
        <figcaption class="figure-caption"></figcaption>
      </figure>
    </div>
    <br>

    <p>The solution to creating an effective outline shader that will work for all geometry and colors, is to take
      into account <i>color</i>, <i>normal vector</i>
      and/or <i>depth</i> discontinuities. But how do we detect these discontinuities?</p>
    <br>

    <!--DEPTH NORMALS TEXTURE-->
    <h2 class="mt-4 mb-3">Depth + Normals Texture</h2>
    <p>The <a target="_blank"
        href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@7.1/manual/index.html">Universal
        Render Pipeline</a> generates a texture called the <i>_CameraColorTexture</i>. This texture gives us a
      look at all the colors in the scene without any post-processing. We can use it to detect color disconinuities
      in the scene. A second
      texture that can be generated by URP, is the <i>_CameraDepthTexture</i>. This texture gives us a color
      gradient representing the depth of objects in the scene. It uses the red channel so that's why the texture is
      tinted red.</p>

    <br><br>
    <div class="text-center">
      <figure class="figure ">
        <img src="img/shaders/outline/CameraColorTexture.png" width="300" class="figure-img" alt="">
        <figcaption class="figure-caption">_CameraColorTexture</figcaption>
      </figure>
      <figure class="figure ">
        <img src="img/shaders/outline/CameraDepthTexture.png" width="300" class="figure-img" alt="">
        <figcaption class="figure-caption">_CameraDepthTexture</figcaption>
      </figure>
      <figure class="figure ">
        <img src="img/shaders/outline/CameraDepthNormalsTexture.png" width="300" class="figure-img" alt="">
        <figcaption class="figure-caption">_CameraDepthNormalsTexture</figcaption>
      </figure>
    </div>
    <br>

    <p>A third commonly used texture is the <i>_CameraDepthNormalsTexture</i> which is a texture that combines the depth
      and normals information of the scene into 1 texture. Sadly, URP does not
      generate a depth + normals texture. However, it is possible for us to modify the pipeline to generate this texture
      for us so that we can sample it and use this information in our outline shader. To do this, we will be modifying
      the pipeline by adding a <a target="_blank"
        href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@7.1/api/UnityEngine.Rendering.Universal.ScriptableRendererFeature.html?q=Renderer%20Feature">Scriptable
        Renderer Feature</a>.</p>
    <br>

    <!-- SCRIPTABLE RENDERER FEATURE -->
    <h2 class="mt-4 mb-3">Scriptable Renderer Feature</h2>
    <p>To generate the <i>_CameraDepthNormalsTexture</i> we will be creating our own custom scriptable renderer feature.
      A
      scriptable
      renderer feature can be used to inject render passes into the renderer. We will be creating a script called
      <i>DepthNormalsFeature.cs</i>. This script will include the <i>ScriptableRendererFeature</i> as well as the
      <i>ScriptableRendererPass</i>. <br><br>The code is as follows.</p>


    <script src="https://gist.github.com/AlexanderAmeye/55ad39fdbffca9f98fe86aa568af0833.js"></script>
    <br>
    <p>Now in our renderer asset we can add the DepthNormalsFeature to our renderer features list by using the little
      plus icon.</p>

    <br>
    <div class="text-center">
      <figure class="figure ">
        <img src="img/shaders/outline/DepthNormalsFeature.png" class="figure-img" alt="">
        <figcaption class="figure-caption"></figcaption>
      </figure>
    </div>
    <br>

    <p>One more important thing that you should do is check the <i>Depth Texture</i> box in your pipeline asset. This
      should be done
      because we will be using this generated depth texture in our outline shader so we want the rendering pipeline to
      generate it for us.</p>

    <br>
    <div class="text-center">
      <figure class="figure ">
        <img src="img/shaders/outline/GenerateDepthTexture.png" class="figure-img" alt="">
        <figcaption class="figure-caption"></figcaption>
      </figure>
    </div>

    <p>Instead of using the _CameraDepthTexture for depth, we could also just use the _CameraDepthNormalsTexture and
      decode both normals and depth information from it since the texture contains both. However, I believe that the
      _CameraDepthTexture provides
      greater precision when it comes to depth values. That's why we will be getting depth from the _CameraDepthTexture,
      normals from the _CameraDepthNormalsTexture and color from the _CameraColorTexture.</p>
    <br>

    <!-- OUTLINE SHADER -->
    <h2 class="mt-4 mb-3">Outline Shader</h2>
    <p>The next step is to sample this newly generated <i>_CameraDepthNormalsTexture</i> in our shader. We will be using
      the <a target="_blank"
        href="https://docs.unity3d.com/Packages/com.unity.shadergraph@7.1/manual/Custom-Function-Node.html">Custom
        Function</a> node in shader graph to create the bulk of our outline shader. The custom function node
      refers to a file
      called <i>Outline.hlsl</i> with a function called <i>Outline</i>.</p>

    <br>
    <div class="text-center">
      <figure class="figure ">
        <img src="img/shaders/outline/CustomFunction.png" class="figure-img" alt="">
        <figcaption class="figure-caption">The custom function node</figcaption>
      </figure>
    </div>
    <br><br>

    <p>The code for the <i>Outline.hlsl</i> file can be found below.</p>


    <script src="https://gist.github.com/AlexanderAmeye/fffe2ad4ec56ba1dbc3849bc66a1875c.js"></script>
    <br>

    <p>Now if you were to apply this shader to an object, you would get an undesired effect. This is because we will be
      using this shader as an image effect. This is useful if we want the outline to be applied to all of the objects in
      the scene.</p>
    <br>

    <!--IMAGE EFFECT-->
    <h2 class="mt-4 mb-3">Image Effect</h2>
    <p>To add the outline as a screen-space image effect, we will be creating another renderer feature with a script
      called <i>OutlineFeature.cs</i>. <br><br>The code looks like this.</p>


    <script src="https://gist.github.com/AlexanderAmeye/fe56c473544d2491b6114a3f178020a0.js"></script>
    <br>

    <p>We add this pass to our renderer as a renderer feature and so now we have 2 renderer features. Make sure to
      assign the outline material to the material slot in the <i>OutlineFeature</i> renderer feature.</p>

    <br>
    <div class="text-center">
      <figure class="figure ">
        <img src="img/shaders/outline/OutlineFeature.png" class="figure-img" alt="">
        <figcaption class="figure-caption"></figcaption>
      </figure>
    </div>
    <br>
    <p>And that's it! You should now see an outline in your scene and be able to control the outline settings through
      the outline material inspector.</p>


    <br>
    <div class="text-center">
      <figure class="figure ">
        <video width="800" class="img-fluid" autoplay loop muted playsinline>
          <source src="img/videos/outline.mp4" type="video/mp4">
        </video>
      </figure>
    </div>
    <br>


   <!-- <h2 class="mt-4 mb-3">Per-object Outline</h2>
    <p>In the case that you only want an outline applied to specific objects in the scene, simply remove the 2nd image
      effect pass and change the outline shader to output the float <i>edge</i> instead of overlaying it with the
      <i>_CameraColorTexture</i>. Then, use the following nodes.</p>


    <br>
    <div class="text-center">
      <figure class="figure ">
        <img src="img/shaders/outline/perobjectoutline.png" width="800" class="figure-img" alt="">
        <figcaption class="figure-caption"></figcaption>
      </figure>
    </div>
    <br>

    <p>This will lerp between an outline color and the main texture based on where the outline is. Please note that the
      output of the custom function node was changed to a vector1 since we now output 1 or 0 whether there is an outline
      or not instead of a color.</p>
    <br>-->
    <h2 class="mt-4 mb-3">Useful Resources</h2>
    <p>Here are some extra resources that helped me write this tutorial.</p>

    <a target="_blank"
      href="https://roystan.net/articles/outline-shader.html">https://roystan.net/articles/outline-shader.html</a><br>
    <a target="_blank"
      href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@7.1/manual/universalrp-builtin-feature-comparison.html">https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@7.1/manual/universalrp-builtin-feature-comparison.html</a>


    <br><br><br>

    <div class="row" style="padding-left: 15px;">
      <div class="col-7 tutorial-footer">
        <div class="col">
          <div class="row">
            <p>Have questions or feedback? Contact me! </p>
          </div>
          <div class="row">
            <div class="col-0">
              <a target="_blank" href="https://twitter.com/alexanderameye" id="link">twitter</a>
            </div>
            <div class="col-1">
              <a href="mailto:alexanderameye@gmail.com" id="link">alexanderameye@gmail.com</a>
            </div>
          </div>
        </div>
      </div>

      <div class="col-4 download-package">
        <div class="col">
          <div class="row">
            <p>Download the source files</p>
          </div>
          <div class="row">
            <div class="col-0">
              <a href="packages/outlineshader.unitypackage" download rel="nofollow"
                class="button">outlineshader.unitypackage</a>
            </div>
          </div>
        </div>
      </div>
    </div>



    <br><br><br>

  </div>
  <script src="js/jquery/jquery.min.js"></script>
  <script src="js/popper/popper.min.js"></script>
  <script src="js/bootstrap/bootstrap.min.js"></script>
</body>

</html>